<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>On-Grid Solar System — Step-by-step Animation</title>
  <style>
    :root{
      --bg:#0f1724; /* deep navy */
      --panel:#0ea5a3;
      --sun:#ffd166;
      --inverter:#ef476f;
      --grid:#94a3b8;
      --house:#f8f9fa;
      --accent:#7c3aed;
      --glass: rgba(255,255,255,0.08);
      --glass-2: rgba(255,255,255,0.03);
      --text:#e6eef8;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg), #071021);color:var(--text)}header{padding:18px 28px;display:flex;align-items:center;gap:16px}
header h1{font-size:18px;margin:0}
.wrap{display:flex;gap:20px;padding:16px;max-width:1200px;margin:0 auto}

/* Scene area */
.scene{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;padding:18px;min-height:520px;position:relative;overflow:hidden}
.controls{width:360px;min-width:300px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px}

/* Top info */
.legend{display:flex;gap:10px;align-items:center;margin-bottom:10px}
.legend .dot{width:10px;height:10px;border-radius:50%}

/* SVG styling */
svg{width:100%;height:440px}
.sun{filter:drop-shadow(0 6px 12px rgba(255,200,55,0.12))}
.rays{transform-origin:50% 50%}
.rays.animate{animation:spinRays 6s linear infinite}
@keyframes spinRays{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

.panel{fill:var(--panel);stroke:#063235;stroke-width:2}
.panel-glass{fill:var(--glass)}

.inverter{fill:var(--inverter);stroke:#6b0a2a;stroke-width:2}
.box{fill:var(--glass-2);stroke:rgba(255,255,255,0.04);stroke-width:1}
.grid{fill:var(--grid);stroke:#6b7280}
.house{fill:var(--house);stroke:#e2e8f0}

/* arrows */
.arrow{stroke:rgba(255,255,255,0.55);stroke-width:4;fill:none;stroke-linecap:round;stroke-linejoin:round;opacity:0.28}
.arrow.active{opacity:1;animation:dash 1s linear both}
@keyframes dash{from{stroke-dashoffset:1000}to{stroke-dashoffset:0}}

/* moving electron dot */
.electron{position:absolute;width:12px;height:12px;border-radius:50%;background:linear-gradient(180deg,#fff, #ffd);box-shadow:0 0 12px rgba(255,220,90,0.9);transform:translate(-50%, -50%);pointer-events:none;opacity:0}
.electron.show{opacity:1}

/* meter */
.meter{transform-origin:50% 50%;transition:transform 0.6s linear}

/* panel cells shimmer */
.panel-cells rect{fill:rgba(255,255,255,0.06)}
.panel-cells.animate rect{animation:cellShine 1.4s linear infinite}
@keyframes cellShine{0%{fill:rgba(255,255,255,0.03)}50%{fill:rgba(255,255,255,0.12)}100%{fill:rgba(255,255,255,0.03)}}

/* inverter waveform */
.wave{stroke:rgba(255,255,255,0.9);stroke-width:2;fill:none;stroke-linecap:round;opacity:0}
.wave.active{opacity:1;animation:wave 0.9s linear infinite}
@keyframes wave{0%{stroke-dashoffset:0}100%{stroke-dashoffset:100}}

/* house lights */
.bulb{fill:gold;opacity:0}
.bulb.on{opacity:1;filter:drop-shadow(0 6px 12px rgba(255,200,80,0.2))}

/* control UI */
.controls h2{margin:0 0 8px 0;font-size:16px}
.desc{font-size:14px;line-height:1.4;color:rgba(230,238,248,0.92);min-height:64px}
.buttons{display:flex;gap:6px;margin-top:12px}
button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--text);cursor:pointer}
button.primary{background:var(--accent);border-color:transparent}
.steps{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px}
.step-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.06);cursor:pointer}
.step-dot.active{background:var(--accent);box-shadow:0 4px 12px rgba(124,58,237,0.25)}
.progress{height:8px;background:rgba(255,255,255,0.03);border-radius:12px;margin-top:12px;overflow:hidden}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent), #7dd3fc);width:0%}

.footer-note{font-size:12px;color:rgba(230,238,248,0.6);margin-top:12px}

/* responsive */
@media (max-width:980px){.wrap{flex-direction:column}.controls{width:100%}}

  </style>
</head>
<body>
  <header>
    <h1>On-Grid Solar System — step-by-step animated explainer</h1>
  </header>  <div class="wrap">
    <div class="scene" id="scene">
      <!-- Electron dot used for animations -->
      <div id="electron" class="electron" aria-hidden="true"></div><!-- SVG diagram -->
  <svg viewBox="0 0 1000 520" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Diagram of solar panels, inverter, house and grid">
    <!-- Sun -->
    <g id="sun" transform="translate(110,90)" class="sun">
      <circle cx="0" cy="0" r="34" fill="var(--sun)" />
      <g class="rays" id="rays">
        <g transform="rotate(0)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(45)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(90)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(135)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(180)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(225)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(270)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
        <g transform="rotate(315)"><rect x="-4" y="-70" width="8" height="28" rx="4" fill="var(--sun)"/></g>
      </g>
    </g>

    <!-- Solar panels -->
    <g id="panels" transform="translate(220,240)">
      <rect x="-4" y="-34" width="260" height="120" rx="12" class="panel-glass" />
      <rect x="0" y="-30" width="250" height="110" rx="10" class="panel" />

      <!-- cells -->
      <g class="panel-cells" transform="translate(10,-20)">
        <!-- 5 columns x 2 rows -->
        <!-- generate rects -->
        <!-- row 1 -->
        <rect x="0" y="0" width="48" height="40" rx="4" />
        <rect x="56" y="0" width="48" height="40" rx="4" />
        <rect x="112" y="0" width="48" height="40" rx="4" />
        <rect x="168" y="0" width="48" height="40" rx="4" />
        <rect x="224" y="0" width="48" height="40" rx="4" />
        <!-- row 2 -->
        <rect x="0" y="46" width="48" height="40" rx="4" />
        <rect x="56" y="46" width="48" height="40" rx="4" />
        <rect x="112" y="46" width="48" height="40" rx="4" />
        <rect x="168" y="46" width="48" height="40" rx="4" />
        <rect x="224" y="46" width="48" height="40" rx="4" />
      </g>
    </g>

    <!-- Inverter -->
    <g id="inverter" transform="translate(520,260)">
      <rect x="-56" y="-44" width="112" height="88" rx="10" class="inverter" />
      <text x="0" y="4" text-anchor="middle" font-size="13" fill="#fff">Inverter</text>
      <!-- waveform -->
      <g transform="translate(-50,40)">
        <path id="wave" d="M4 4 L20 4 L28 0 L36 8 L44 4 L52 4" class="wave" stroke-dasharray="100" stroke-dashoffset="0" />
      </g>
    </g>

    <!-- House -->
    <g id="house" transform="translate(720,280)">
      <rect x="-60" y="-46" width="120" height="92" rx="12" class="box house"/>
      <polygon points="-72,-46 0,-92 72,-46" class="box house"/>
      <text x="0" y="20" text-anchor="middle" font-size="13" fill="#0b1220">Home</text>
      <!-- bulb -->
      <circle id="bulb" cx="0" cy="-6" r="6" class="bulb"/>
    </g>

    <!-- Grid -->
    <g id="grid" transform="translate(880,140)">
      <rect x="-46" y="-34" width="92" height="68" rx="8" class="grid"/>
      <text x="0" y="6" text-anchor="middle" font-size="12" fill="#071021">Grid</text>
    </g>

    <!-- Meter -->
    <g id="meter" transform="translate(840,280)" class="meter">
      <circle cx="0" cy="0" r="26" fill="#0b1220" stroke="#b6c2d7" stroke-width="2"/>
      <text x="0" y="6" text-anchor="middle" font-size="9" fill="#b6c2d7">Meter</text>
    </g>

    <!-- Arrows (simple straight lines) -->
    <!-- Panels -> Inverter -->
    <line id="a1" class="arrow" x1="420" y1="300" x2="470" y2="300" stroke-dasharray="200" stroke-dashoffset="200"/>
    <!-- Inverter -> House -->
    <line id="a2" class="arrow" x1="590" y1="300" x2="660" y2="300" stroke-dasharray="200" stroke-dashoffset="200"/>
    <!-- Inverter -> Grid (export) -->
    <line id="a3" class="arrow" x1="590" y1="260" x2="840" y2="170" stroke-dasharray="400" stroke-dashoffset="400"/>
    <!-- Grid -> House (import) -->
    <line id="a4" class="arrow" x1="840" y1="170" x2="740" y2="260" stroke-dasharray="400" stroke-dashoffset="400"/>
    <!-- Panels -> Meter (illustrative bypass) small line -->
    <line id="a5" class="arrow" x1="420" y1="314" x2="840" y2="300" stroke-dasharray="600" stroke-dashoffset="600" opacity="0.12"/>
  </svg>

  <!-- small caption top-left -->
  <div style="position:absolute;left:20px;top:20px;background:rgba(6,10,14,0.45);padding:8px 10px;border-radius:8px;font-size:13px">Interactive steps: use controls to progress</div>
</div>

<aside class="controls" aria-label="controls">
  <h2 id="stepTitle">Step 1 — Sunlight on Solar Panels</h2>
  <div class="desc" id="stepDesc">Sunlight falls on the solar PV panels. Panels convert sunlight to DC electricity.</div>

  <div class="buttons">
    <button id="prevBtn">◀ Prev</button>
    <button id="nextBtn" class="primary">Next ▶</button>
    <button id="autoBtn">Autoplay</button>
  </div>

  <div class="progress" aria-hidden="true">
    <i id="progressBar"></i>
  </div>

  <div class="steps" id="stepDots" aria-hidden="true"></div>

  <div class="footer-note">This animation demonstrates: DC generation → conversion to AC → supplying home loads → exporting excess to grid and importing from grid when needed.</div>

</aside>

  </div>  <script>
    // Step definitions for the animation
    const steps = [
      {
        title: 'Step 1 — Sunlight on Solar Panels',
        desc: 'Sunlight falls on PV panels. Photons excite electrons producing DC current inside the panel cells.',
        activate: () => {
          // rays spin, panel cells shine
          document.getElementById('rays').classList.add('animate');
          document.querySelector('.panel-cells').classList.add('animate');
          // no electrons moving yet
          stopAllFlows();
        },
        cleanup: () => {
          document.getElementById('rays').classList.remove('animate');
          document.querySelector('.panel-cells').classList.remove('animate');
        }
      },
      {
        title: 'Step 2 — DC produced (Panels → Inverter)',
        desc: 'Panels produce DC power. DC flows to the inverter through DC cables.',
        activate: () => {
          document.getElementById('rays').classList.add('animate');
          document.querySelector('.panel-cells').classList.add('animate');
          animateArrow('a1', {from:{x:420,y:300}, to:{x:470,y:300}}, 1400, {color:'#ffd166'});
        },
        cleanup: () => { stopAllFlows(); document.getElementById('rays').classList.remove('animate'); }
      },
      {
        title: 'Step 3 — Inverter converts DC → AC',
        desc: 'The inverter changes DC electricity into AC (alternating current) suitable for household appliances.',
        activate: () => {
          document.querySelector('.panel-cells').classList.add('animate');
          // show DC arrow then inverter waveform
          animateArrow('a1', {from:{x:420,y:300}, to:{x:470,y:300}}, 800);
          setTimeout(()=>document.getElementById('wave').classList.add('active'), 800);
        },
        cleanup: () => { stopAllFlows(); document.getElementById('wave').classList.remove('active'); }
      },
      {
        title: 'Step 4 — AC supplies the Home (Inverter → Home)',
        desc: 'Converted AC flows from inverter to the house. Loads (lights, fans) are powered by solar-generated electricity.',
        activate: () => {
          document.getElementById('wave').classList.add('active');
          animateArrow('a2', {from:{x:590,y:300}, to:{x:660,y:300}}, 1200, {dotColor:'#fff9b0'});
          // light up house bulb
          setTimeout(()=>document.getElementById('bulb').classList.add('on'), 800);
        },
        cleanup: () => { stopAllFlows(); document.getElementById('bulb').classList.remove('on'); document.getElementById('wave').classList.remove('active'); }
      },
      {
        title: 'Step 5 — Excess sent to Grid (Export)',
        desc: 'If solar production > home consumption, excess AC is exported to the grid. The meter turns to record export.',
        activate: () => {
          document.getElementById('wave').classList.add('active');
          animateArrow('a3', {from:{x:590,y:260}, to:{x:840,y:170}}, 1600, {dotColor:'#bff0d6'});
          rotateMeter(1.6); // forward spin
          // show export visual (meter rotates clockwise)
        },
        cleanup: () => { stopAllFlows(); rotateMeter(0); document.getElementById('wave').classList.remove('active'); }
      },
      {
        title: 'Step 6 — Night / Low Sun: Grid supplies Home (Import)',
        desc: 'During night or low sunlight, the grid supplies the house. Electricity flows from grid to home and the meter rotates in reverse (import).',
        activate: () => {
          // grid -> house arrow
          animateArrow('a4', {from:{x:840,y:170}, to:{x:740,y:260}}, 1500, {dotColor:'#d6e8ff'});
          rotateMeter(-1.4); // reverse spin
          document.getElementById('bulb').classList.remove('on');
        },
        cleanup: () => { stopAllFlows(); rotateMeter(0); }
      },
      {
        title: 'Step 7 — Safety & Disconnect (Protections)',
        desc: 'The system has safety features: isolator and anti-islanding protection which disconnects inverter from grid in faults. (Illustrative only.)',
        activate: () => {
          // quick flash of inverter and grid
          const inv = document.getElementById('inverter');
          inv.classList.add('flash');
          // simulate a rapid blink by toggling panel cells
          document.querySelector('.panel-cells').classList.add('animate');
          setTimeout(()=>{
            document.querySelector('.panel-cells').classList.remove('animate');
            inv.classList.remove('flash');
          }, 1400);
        },
        cleanup: () => { stopAllFlows(); }
      }
    ];

    // UI + state
    let current = 0;
    let autoPlay = false;
    let autoTimer = null;
    const total = steps.length;

    // DOM refs
    const titleEl = document.getElementById('stepTitle');
    const descEl = document.getElementById('stepDesc');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const autoBtn = document.getElementById('autoBtn');
    const progressBar = document.getElementById('progressBar');
    const stepDots = document.getElementById('stepDots');

    // Create step dots
    for(let i=0;i<total;i++){const d=document.createElement('div');d.className='step-dot';d.title = steps[i].title;d.onclick = ()=>goTo(i);stepDots.appendChild(d);} 

    function updateUI(){
      titleEl.textContent = steps[current].title;
      descEl.textContent = steps[current].desc;
      // progress
      const pct = Math.round(((current+1)/total)*100);
      progressBar.style.width = pct + '%';
      // dots
      Array.from(stepDots.children).forEach((el,idx)=>el.classList.toggle('active', idx===current));
    }

    // cleanup helper
    function clearAll(){
      steps.forEach(s=>s.cleanup && s.cleanup());
      stopAllFlows();
    }

    // goTo step
    function goTo(i){
      if(i<0) i=0; if(i>total-1) i=total-1;
      clearAll(); current = i; updateUI();
      // activate
      steps[current].activate && steps[current].activate();
    }

    prevBtn.onclick = ()=>{goTo(current-1); stopAuto();}
    nextBtn.onclick = ()=>{goTo(current+1); stopAuto();}
    autoBtn.onclick = ()=>{autoPlay = !autoPlay; autoBtn.textContent = autoPlay ? 'Stop Autoplay' : 'Autoplay'; if(autoPlay) startAuto(); else stopAuto();}

    function startAuto(){ if(autoTimer) clearInterval(autoTimer); autoTimer = setInterval(()=>{goTo((current+1)%total);}, 2800); }
    function stopAuto(){ if(autoTimer) clearInterval(autoTimer); autoPlay=false; autoBtn.textContent='Autoplay'; }

    // ---------- Animations for arrows & electrons ----------
    let runningElectrons = [];
    function animateArrow(id, line, duration=1200, opts={}){
      // id: svg line id
      // line: {from:{x,y}, to:{x,y}}
      const arrow = document.getElementById(id);
      if(!arrow) return;
      arrow.classList.add('active');
      // animate electron dot along the straight line using requestAnimationFrame
      const elDot = document.getElementById('electron');
      elDot.classList.add('show');
      // cancel previous if any
      stopAllFlows();
      let start = null;
      const dx = line.to.x - line.from.x;
      const dy = line.to.y - line.from.y;
      const stepsCount = Math.max(1, Math.floor(duration / 16));
      let rafId = null;
      function step(ts){
        if(!start) start = ts;
        const t = Math.min(1, (ts - start) / duration);
        const x = line.from.x + dx * t;
        const y = line.from.y + dy * t;
        // position electron (scene is absolute positioned)
        const sceneRect = document.getElementById('scene').getBoundingClientRect();
        // svg viewBox is 1000x520 mapped to the scene svg element, so compute scale
        const svg = document.querySelector('svg');
        const svgRect = svg.getBoundingClientRect();
        const scaleX = svgRect.width / 1000;
        const scaleY = svgRect.height / 520;
        const left = svgRect.left + x * scaleX;
        const top = svgRect.top + y * scaleY;
        elDot.style.left = left + 'px';
        elDot.style.top = top + 'px';

        if(t < 1){ rafId = requestAnimationFrame(step); runningElectrons.push(rafId);} else {
          // finish
          // small pause then hide dot
          setTimeout(()=>{elDot.classList.remove('show');}, 250);
          arrow.classList.remove('active');
        }
      }
      rafId = requestAnimationFrame(step);
      runningElectrons.push(rafId);
    }

    function stopAllFlows(){
      // cancel RAFs
      runningElectrons.forEach(id=>cancelAnimationFrame(id)); runningElectrons = [];
      // hide electron
      const el = document.getElementById('electron'); el.classList.remove('show');
      // remove arrow active classes
      Array.from(document.querySelectorAll('.arrow')).forEach(a=>a.classList.remove('active'));
    }

    // Rotate meter: posSpeed >0 rotate clockwise, <0 rotate counter
    let meterInterval = null;
    function rotateMeter(speed){
      const m = document.getElementById('meter');
      if(meterInterval) clearInterval(meterInterval);
      if(!speed || speed===0){ m.style.transform = 'rotate(0deg)'; return; }
      let angle = 0;
      meterInterval = setInterval(()=>{ angle += (speed * 6); m.style.transform = `rotate(${angle}deg)`; }, 120);
    }

    // Initialize UI
    updateUI(); goTo(0);

    // Accessibility: keyboard
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') { goTo(current+1); stopAuto(); }
      if(e.key === 'ArrowLeft') { goTo(current-1); stopAuto(); }
      if(e.key === ' ') { e.preventDefault(); autoBtn.click(); }
    });

    // Resize handler: stop animations to reposition electron
    window.addEventListener('resize', ()=>{ stopAllFlows(); });

      // Small enhancement: flashing inverter style (added dynamically)
    const style = document.createElement('style');
    style.innerHTML = '.flash{animation:flashIt 0.45s linear 0s 3;}
      @keyframes flashIt{0%{filter:brightness(1)}50%{filter:brightness(1.8)}100%{filter:brightness(1)}}';
    document.head.appendChild(style);

    // Notes for users
    // - You can step through each stage. - The diagram is illustrative and simplified for education.

  </script>
</body>
</html>
